{% set pyproject = load_file_data("../pyproject.toml", from_recipe_dir=True) %}

package:
  name: pysteps
  version: {{ pyproject.get("project").get("version") }}

source:
  git_url: https://github.com/munch-group/pysteps.git

build:
  # noarch: python
  number: 0
  activate_in_script: false  # [win]
  missing_dso_whitelist:
    - '*.dll'  # [win]
  script: {{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation
  # python_version_independent: true
  entry_points:
    - pysteps = pysteps.pysteps:run_student_file

requirements:
  host:
    - python
    - pip
    - setuptools    
  build:
    - {{ compiler('c') }}  # [not win]
    - {{ compiler('cxx') }}  # [not win]
    # On Windows, compilers are handled differently
    - m2w64-toolchain  # [win]
  host:
    - python
    - pip
    - setuptools
  run:  # your library dependencies
    {% for dep in pyproject.get("project").get("dependencies") %}
    - {{ dep.lower() }}
    {% endfor %}  


# channels:  # channels for your library dependencies
#   - conda-forge
#   - sepandhaghighi

# extra:
#   channels: 
#     - conda-forge
#     - sepandhaghighi

dependencies:   # keep this block with only these packages
  - anaconda-client
  - conda-build>=25.1.3 # from 25 the output file is a .conda not .tar.bz2
  - conda-verify
  - conda-package-handling
  # - conda-forge/label/python_rc::_python_rc # Dummy package to force selection of python_rc channel when channel_priority is set to strict

test:
  imports:
    - pysteps

about:
  home: https://github.com/munch-group/pysteps.git
  license: MIT
  dev_url: https://github.com/munch-group/pysteps.git
  doc_url: https://munch-group.org/pysteps
